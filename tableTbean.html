<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="utf-8">
    <title>snowwolf</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./plugins/layui/css/layui.css" media="all">
    <script src="./js/jquery-3.0.0.js"></script>
</head>

<body>
<div class="layui-tab">
    <ul class="layui-tab-title">
        <li class="layui-this">单表转Bean</li>
        <li>多表转Bean</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item"></div>
            </form>
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">数据库</label>
                        <div class="layui-input-inline">
                            <select name="db" id="dbName" class="dbOption"  lay-verify="required" lay-search="" lay-filter="findDB">
                                <option value="">直接选择或搜索选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">表名</label>
                        <div class="layui-input-inline">
                            <select class="tableOption" id="tbName" name="table" lay-verify="required" lay-search="" lay-filter="findTable">
                                <option value="">直接选择或搜索选择</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">Bean类型</label>
                    <div class="layui-input-block" id="beanType">
                        <input type="radio" name="beanType" value="Eo" title="Eo" checked="">
                        <input type="radio" name="beanType" value="Vo" title="Vo">
                        <input type="radio" name="beanType" value="Dto" title="Dto" >
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">bean注解</label>
                    <div class="layui-input-block" id="beanAnnotion">
                        <input type="checkbox" name="entityList"  value="Id" title="Id" checked="">
                        <input type="checkbox" name="entityList" value="Table" title="Table" checked="">
                        <input type="checkbox" name="entityList" value="ApiModel" title="ApiModel" checked="">
                        <input type="checkbox" name="entityList" value="ApiModelProperty" title="ApiModelProperty" checked="">
                        <input type="checkbox" name="entityList"  value="Column" title="Column" checked="">
                    </div>
                </div>

                <div class="layui-form-item" pane="">
                    <label class="layui-form-label">属性注解</label>
                    <div class="layui-input-block" id="propertyAnnotion">
                        <input type="checkbox" name="propertyList" value="Entity" lay-skin="primary" title="Entity">
                        <input type="checkbox" name="propertyList" value="Data" lay-skin="primary" title="Data">
                        <input type="checkbox" name="propertyList" value="NotNull" lay-skin="primary" title="NotNull">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">类保存路径</label>
                    <div class="layui-input-block">
                        <input type="text" id="path" name="path" lay-verify="path" autocomplete="off"  placeholder="请输入保存路径" class="layui-input">
                    </div>
                </div>


                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">自定义类名</label>
                        <div class="layui-input-block">
                            <input type="checkbox"  name="close" lay-skin="switch" lay-filter="switchEntity" lay-text="ON|OFF">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">自定义包头</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="close" lay-skin="switch" lay-filter="switchImport" lay-text="ON|OFF">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item" id="classType">
                    <div id="entityName"  class="layui-hide">
                        <label class="layui-form-label">实体类名称</label>
                        <div class="layui-input-inline">
                            <input type="text" id="className" name="entityName" lay-verify="entityName" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div  class="layui-hide" id="importUrl">
                        <label class="layui-form-label">包头</label>
                        <div class="layui-input-inline">
                            <input type="text" id="ipUrl" name="importUrl" lay-verify="importUrl" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

            </form>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" lay-filter="createBean">生成实体类</button>
                    </div>
                </div>
            </div>
        </div>

        <!--tab tow-->
        <div class="layui-tab-item">
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">添加表参数</label>
                    <div class="layui-inline">
                        <div class="layui-input-block">
                            <input type="button" onclick="" class="layui-btn layui-btn-primary layui-btn-sm" value="add">
                            </input>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">数据库</label>
                        <div class="layui-input-inline">
                            <select name="more_db" id="more_dbName" class="more_dbOption"  lay-verify="required" lay-search="" lay-filter="more_findDB">
                                <option value="">直接选择或搜索选择</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">表名</label>
                        <div class="layui-input-inline">
                            <select class="more_tableOption" id="more_tbName" name="more_table" lay-verify="required" lay-search="" lay-filter="more_findTable">
                                <option value="">直接选择或搜索选择</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div>
                        表一参数设置&nbsp;&nbsp;&nbsp;
                        <input type="checkbox" name="one" lay-skin="switch" lay-text="清空">
                    </div>
                    <table class="layui-table">
                        <colgroup>
                            <col width="50">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>层级</td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="one_tier" value="parent" title="parent" checked="">
                                    <input type="radio" name="one_tier" value="sun" title="sun">
                                    <input type="radio" name="one_tier" value="gransun" title="grandsun" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                数据类型
                            </td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="one_dataType" value="property" title="property" checked>
                                    <input type="radio" name="one_dataType" value="Object" title="Object">
                                    <input type="radio" name="one_dataType" value="List" title="List<Object>" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>字段</td>
                            <td>
                                <input type="checkbox" name="one_colum" lay-skin="switch" lay-text="全选">
                                <div class="layui-input-block" id="more_columInfo">

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="layui-form-item layui-hide">
                    <div>
                        表二参数设置&nbsp;&nbsp;&nbsp;
                        <input type="checkbox" name="tow" lay-skin="switch" lay-text="清空">
                    </div>
                    <table class="layui-table">
                        <colgroup>
                            <col width="50">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>层级</td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="tow_tier" value="parent" title="parent" checked="">
                                    <input type="radio" name="tow_tier" value="sun" title="sun">
                                    <input type="radio" name="tow_tier" value="gransun" title="grandsun" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                数据类型
                            </td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="tow_dataType" value="property" title="property" checked>
                                    <input type="radio" name="tow_dataType" value="Object" title="Object">
                                    <input type="radio" name="tow_dataType" value="List" title="List<Object>" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>字段</td>
                            <td>
                                <input type="checkbox" name="tow_colum" lay-skin="switch" lay-text="全选">
                                <div class="layui-input-block" id="more_columInfo1">

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="layui-form-item layui-hide">
                    <div>
                        表三参数设置&nbsp;&nbsp;&nbsp;
                        <input type="checkbox" name="three" lay-skin="switch" lay-text="清空">
                    </div>
                    <table class="layui-table">
                        <colgroup>
                            <col width="50">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>层级</td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="three_tier" value="parent" title="parent" checked="">
                                    <input type="radio" name="three_tier" value="sun" title="sun">
                                    <input type="radio" name="three_tier" value="gransun" title="grandsun" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                数据类型
                            </td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="three_dataType" value="property" title="property" checked>
                                    <input type="radio" name="three_dataType" value="Object" title="Object">
                                    <input type="radio" name="three_dataType" value="List" title="List<Object>" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>字段</td>
                            <td>
                                <input type="checkbox" name="three_colum" lay-skin="switch" lay-text="全选">
                                <div class="layui-input-block" id="more_columInfo2">

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="layui-form-item layui-hide">
                    <div>
                        表四参数设置&nbsp;&nbsp;&nbsp;
                        <input type="checkbox" name="four" lay-skin="switch" lay-text="清空">
                    </div>
                    <table class="layui-table">
                        <colgroup>
                            <col width="50">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>层级</td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="four_tier" value="parent" title="parent" checked="">
                                    <input type="radio" name="four_tier" value="sun" title="sun">
                                    <input type="radio" name="four_tier" value="gransun" title="grandsun" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                数据类型
                            </td>
                            <td>
                                <div class="layui-input-block">
                                    <input type="radio" name="four_dataType" value="property" title="property" checked>
                                    <input type="radio" name="four_dataType" value="Object" title="Object">
                                    <input type="radio" name="four_dataType" value="List" title="List<Object>" >
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>字段</td>
                            <td>
                                <input type="checkbox" name="four_colum" lay-skin="switch" lay-text="全选">
                                <div class="layui-input-block" id="more_columInfo3">

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>


                <div class="layui-form-item">
                    <label class="layui-form-label">Bean类型</label>
                    <div class="layui-input-block" id="more_beanType">
                        <input type="radio" name="more_beanType" value="Vo" title="Vo" checked="">
                        <input type="radio" name="more_beanType" value="Dto" title="Dto" >
                    </div>
                </div>


                <div class="layui-form-item">
                    <label class="layui-form-label">类保存路径</label>
                    <div class="layui-input-block">
                        <input type="text" id="more_path" name="more_path" lay-verify="more_path" autocomplete="off"  placeholder="请输入保存路径" class="layui-input">
                    </div>
                </div>


                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">自定义类名</label>
                        <div class="layui-input-block">
                            <input type="checkbox"  name="close" lay-skin="switch" lay-filter="more_switchEntity" lay-text="ON|OFF">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">自定义包头</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="close" lay-skin="switch" lay-filter="more_switchImport" lay-text="ON|OFF">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item" id="more_classType">
                    <div id="more_entityName"  class="layui-hide">
                        <label class="layui-form-label">实体类名称</label>
                        <div class="layui-input-inline">
                            <input type="text" id="more_className" name="more_entityName" lay-verify="more_entityName" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div  class="layui-hide" id="more_importUrl">
                        <label class="layui-form-label">包头</label>
                        <div class="layui-input-inline">
                            <input type="text" id="more_ipUrl" name="more_importUrl" lay-verify="more_importUrl" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

            </form>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" lay-filter="more_createBean">生成实体类</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="./plugins/layui/layui.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['form', 'element', 'layedit', 'laydate'], function() {
        var form = layui.form,
            element = layui.element,
            layer = layui.layer,
            layedit = layui.layedit,
            laydate = layui.laydate;
        layedit.build('LAY_demo_editor');

        //自定义验证规则
        form.verify({
            path: function(value) {
                if (value.length < 1) {
                    return '必须输入实体类保存路径！';
                }
            }
        });
        //获取端口
        var port = window.location.port;
        //查询出所有的库
        $(document).ready(function(){
            //console.log("ready");
            var httpurl = "http://localhost:"+port+"/tool/db/tag";
            $.ajax({
                type: 'get',
                url: httpurl, // ajax请求路径
                dataType : "json",
                success: function(data){
                    $('#beanAnnotion').empty();
                    $('#propertyAnnotion').empty();
                    var beanAnnotion = '';
                    var propertyAnnotion = '';
                    $.each(data.data.entityList,function(v,o){
                        //console.info(o.schemaName);
                        beanAnnotion += '<input type="checkbox" name="entityList"  value="'+o+'" title="'+o+'" checked="">';
                    });
                    $.each(data.data.columList,function(v,o){
                        //console.info(o.schemaName);
                        propertyAnnotion += '<input type="checkbox" name="propertyList" value="'+o+'" lay-skin="primary" title="'+o+'">';
                    });
                    $('#beanAnnotion').append(beanAnnotion);
                    $('#propertyAnnotion').append(propertyAnnotion);
                    form.render();
                }
            });


            var url = "http://localhost:"+port+"/tool/db/findAllDB";
            $.ajax({
                type: 'get',
                url: url, // ajax请求路径
                dataType : "json",
                success: function(data){
                    $('.dbOption').empty();
                    var option = '<option value="">直接选择或搜索选择</option>';
                    $.each(data.list,function(v,o){
                        //console.info(o.schemaName);
                        option += '<option value="'+o.schemaName+'" >'+o.schemaName+'</option>';
                    });
                    $('.dbOption').append(option);

                    //多表的时候
                    $('.more_dbOption').empty();
                    $('.more_dbOption').append(option);
                    form.render('select');
                }
            });
        });

        //查询选择的数据库对应的表
        form.on('select(findDB)', function(data){
            var dbName = data.value;
            //console.log(dbName);
            if (dbName =="") {
                layer.msg('请选择数据库名称！');
                return ;
            }
            var url = "http://localhost:"+port+"/tool/db/findTable?dbName="+dbName;
            $.ajax({
                type: 'get',
                url: url, // ajax请求路径
                dataType : "json",
                success: function(data,status){
                    $('.tableOption').empty();
                    var option = '<option value="">直接选择或搜索选择</option>';
                    $.each(data.list,function(v,o){
                        //console.info(o.tableName);
                        option += '<option value="'+o.tableName+'" >'+o.tableName+'</option>';
                    });
                    $('.tableOption').append(option);
                    form.render('select');
                }
            });
            layer.msg('查询数据库成功！');
        });


        form.on('select(findTable)', function(data){
            var tableName = data.value;
            if (tableName =="") {
                layer.msg('请选择选定表！');
                return ;
            }else{
                layer.msg('选定了表！');
            }
        });

        form.on('switch(switchEntity)', function(data) {
            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            if(this.checked){
                $('#entityName').removeClass('layui-hide');
                $('#entityName').attr('class','layui-inline');//替换成一个新class
            }else{
                $('#entityName').removeClass('layui-inline');
                $('#entityName').attr('class','layui-hide');//替换成一个新class
            }
        });

        form.on('switch(switchImport)', function(data) {
            //console.log(this.checked);
            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            if(this.checked){
                $('#importUrl').removeClass('layui-hide');
                $('#importUrl').attr('class','layui-inline');//替换成一个新class
            }else{
                $('#importUrl').removeClass('layui-inline');
                $('#importUrl').attr('class','layui-hide');//替换成一个新class
            }
        });

        form.on('submit(createBean)', function(data) {
            var dbName = $("#dbName").val();
            var tableName = $("#tbName").val();
            var path = $("#path").val();
            var className = $("#className").val();
            var ipUrl = $("#ipUrl").val();
            var  params = [];
            var entityList = [];
            var propertyList = [];
            var beanType = $('#beanType input[name="beanType"]:checked ').val();
            console.info(beanType);
            $("input:checkbox[name='entityList']:checked").each(function(){
                entityList.push($(this).val());
            });
            $("input:checkbox[name='propertyList']:checked").each(function(){
                propertyList.push($(this).val());
            });
            params.push({"beanType":beanType,"dbName":dbName,"tableName":tableName,"path":path,
                "entityList":entityList,"propertyList":propertyList,"className":className,"packageName":ipUrl});
            var jsonStr = JSON.stringify(params[0]);
            //console.log(jsonStr);
            var url = "http://localhost:"+port+"/tool/db/create";
            $.ajax({
                type: "POST",
                url: url,
                contentType: "application/json",
                dataType: "json",
                data: jsonStr,
                success: function (data,status) {
                    //console.log(data.msg);
                    //console.log(data.data);
                    if("SUCCESS"==data.msg){
                        layer.msg(data.data+'生成实体类成功！');
                    }
                }
            });
            return false;
        });


        //多表的JS
        //查询选择的数据库对应的表
        form.on('select(more_findDB)', function(data){
            var dbName = data.value;
            console.log(dbName);
            if (dbName =="") {
                layer.msg('请选择数据库名称！');
                return ;
            }
            var url = "http://localhost:"+port+"/tool/db/findTable?dbName="+dbName;
            $.ajax({
                type: 'get',
                url: url, // ajax请求路径
                dataType : "json",
                success: function(data,status){
                    $('.more_tableOption').empty();
                    var option = '<option value="">直接选择或搜索选择</option>';
                    $.each(data.list,function(v,o){
                        //console.info(o.tableName);
                        option += '<option value="'+o.tableName+'" >'+o.tableName+'</option>';
                    });
                    $('.more_tableOption').append(option);
                    form.render('select');
                }
            });
            layer.msg('查询数据库成功！');
        });



        form.on('select(more_findTable)', function(data){
            var dbName = $("#more_dbName").val();
            var tableName = data.value;
            if (tableName =="") {
                layer.msg('请选择选定表！');
                return ;
            }else{
                var url = "http://localhost:"+port+"/tool/db/findColum?dbName="+dbName+"&tableName="+tableName;
                $.ajax({
                    type: 'get',
                    url: url, // ajax请求路径
                    dataType : "json",
                    success: function(data,status){
                        $('#more_columInfo').empty();
                        var columInfo = '';
                        $.each(data.list,function(v,o){
                            columInfo += '<input type="checkbox" name="columName" value="'+o.columnName+'" lay-skin="primary" title="'+o.columnName+'">';
                        });
                        $('#more_columInfo').append(columInfo);
                        form.render();
                    }
                });
                layer.msg('查询表信息成功！');
            }
        });



        form.on('submit(more_createBean)', function(data) {
            var dbName = $("#more_dbName").val();
            var tableName = $("#more_tbName").val();
            var path = $("#more_path").val();
            var className = $("#more_className").val();
            var ipUrl = $("#more_ipUrl").val();
            var  params = [];
            var columNameList = [];
            var propertyList = [];
            var beanType = $('#more_beanType input[name="more_beanType"]:checked ').val();
            console.info(beanType);
            $("input:checkbox[name='more_columName']:checked").each(function(){
                columNameList.push($(this).val());
            });
//            $("input:checkbox[name='propertyList']:checked").each(function(){
//                propertyList.push($(this).val());
//            });
            params.push({"beanType":beanType,"dbName":dbName,"tableName":tableName,"path":path,
                "columNameList":columNameList,"propertyList":propertyList,"className":className,"packageName":ipUrl});
            var jsonStr = JSON.stringify(params[0]);
            console.log(jsonStr);
//            var url = "http://localhost:"+port+"/tool/db/create";
//            $.ajax({
//                type: "POST",
//                url: url,
//                contentType: "application/json",
//                dataType: "json",
//                data: jsonStr,
//                success: function (data,status) {
//                    //console.log(data.msg);
//                    //console.log(data.data);
//                    if("SUCCESS"==data.msg){
//                        layer.msg(data.data+'生成实体类成功！');
//                    }
//                }
//            });
            layer.msg('生成实体类成功！');
            return false;
        });

    });
</script>

</body>

</html>